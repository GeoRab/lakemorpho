---
title: 'lakemorpho: Calculating lake morphometry metrics in R'
author:  
- name: Jeffrey W. Hollister
  affilnum: '1'
affiliation:
- affilnum: 1
  affil: US Environmental Protection Agency, Office of Research and Development, National Health and Environmental Effects Research Laboratory, Atlantic Ecology Division, 27 Tarzwell Drive  Narragansett, RI, 02882, USA
output:
  pdf_document:
    fig_caption: yes
    keep_tex: yes
    number_sections: yes
    template: components/manuscript.latex
  html_document: null
  word_document: null
fontsize: 11pt
capsize: normalsize
csl: components/plos.csl
documentclass: article
spacing: doublespacing
linenumbers: no
bibliography: components/manuscript.bib
abstract: no
---
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{lakemorpho: Calculating lake morphometry metrics in R}
-->

```{r setup, include=FALSE, echo=FALSE}
#Put whatever you normally put in a setup chunk.
#I usually at least include:
#devtools::install_github("manuscriptPackage","jhollist")
#library("manuscriptPackage")
#Didn't do that here to expedite building of the example vignette
library("knitr")

opts_chunk$set(dev = 'pdf', fig.width=6, fig.height=5)

# Table Captions from @DeanK on http://stackoverflow.com/questions/15258233/using-table-caption-on-r-markdown-file-using-knitr-to-use-in-pandoc-to-convert-t
#Figure captions are handled by LaTeX

knit_hooks$set(tab.cap = function(before, options, envir) {
                  if(!before) { 
                    paste('\n\n:', options$tab.cap, sep='') 
                  }
                })
default_output_hook = knit_hooks$get("output")
knit_hooks$set(output = function(x, options) {
  if (is.null(options$tab.cap) == FALSE) {
    x
  } else
    default_output_hook(x,options)
})
```

```{r analysis , include=FALSE, echo=FALSE, cache=FALSE}
#All analysis in here, that way all bits of the paper have access to the final objects
#Place tables and figures and numerical results where they need to go.
```

<!-- Abstract is being wrapped in latex here so that all analysis can be run in the chunk above and the results reproducibly referenced in the abstract. -->

\singlespace

\vspace{2mm}\hrule

Metrics describing the shape and size of lakes, known as lake morphometry metrics, are important for any limnological study.  In cases where a lake has long been the subject of study these data are often already collected and the data is openly available.  Many other lakes have this data collected, but access to the data is challenging as it is often stored on individual computers (or worse in filing cabinets) and is available only to the primary investigators.  The vast majority of lakes fall into a third category in which the data is not available.  This makes broad scale modelling of lake ecology a challenge as some of the key information about in-lake processes are unavailable.  While this valuable *in situ* information may be difficult to obtain, several national datasets exist that may be used to model and estimate lake morphometry.  In particular digital elevation models and hydrography have been shown to be predicitive of several lake morphometry metrics.  The R package `lakemorpho` has been developed to utilize this data and estimate the following morphometry metrics: surface area, shoreline length, shoreline development, maximum depth, mean depth, volume, maximum lake length, mean lake width, maximum lake width, and fetch. In this software note I describe the motivation behind developing `lakemorpho`, discuss the implementation in R, and describe the use of `lakemorpho` with an example of a typical use case.    

\vspace{3mm}\hrule
\doublespace

#Introduction

The study and quantificaiton of lake shape (i.e. lake morphology and morphometry) is one of the foundations of limnology and for students of limnology, some of the first lessons are centered around a typical suite of metrics and how to calculate them [e.g. @wetzel2001limnology].  It is also widely accepted that the morphometry of lakes and ponds can impact available nutrients and thus overall productivity.  For instance, the widely used Vollenweider input-output models that are used to estimate nutrient concentrations rely on hydraulic residence time and sometimes mean depth, both of which are derived from total lake volume [@vollenweider1975input; @milstead2013estimating]. Also, clear water versus turbid water states in lakes have been linked in part to lake morphometry, in particular mean depth [@genkai2005eutrophication].  In short, limnologists have long recognized the importance of lake morphology as one factor controlling a variety of ecological processes in lakes.

Traditional methods for calculating lake morphometry metrics have relied upon the use of paper bathymetry maps, planimeters, or unnecessary assumptions [@kalff2002limnology; @welch1935limnology; @wetzel2000limnological; @hollister2010volume]. In addition, detailed bathymetry is a requirement for most of these methods, but it's collection is only available for a relatively small number of lakes.  This is not a problem when the focus of a study is a single lake, a small number of lakes or on well studied lakes.  Relying on complete bathymetry becomes a limitation when attempting to conduct regional or national studies of lakes as bathymetry is at best difficult to find or does not exist for all lakes of interest.  In these cases alternative approaches for estimating lake morphometry are required.  

Recent work has demonstrated the ability to estimate many of these metrics from ubiquitous spatial data.  For instance, maximum depth and lake volume may be predicted using the lake polygon and surrounding topography [@hollister2010volume; @hollister2011predicting]. The initial development of these tools were developed with proprietary tools thus limiting their use.  In an effort to reach a broader audience the tools were converted to R, expanded to include a more complete suite of lake morphometry metrics and compiled into an R Package.

#Implementation and Use in R

- Why an R package?
- Dependencies
 - required packages
 - required libraries
- Included functions
 - calcLakeMetrics  Calculate all Lake Morphometry Metrics
 - inputLM	lakemorpho class data for 'lakemorpho' examples
 - lakeFetch	Function to calculate fetch along an input bearing
 - lakeMaxDepth	Estimate maximum lake depth
 - lakeMaxLength	Caluclate maximum lake length
 - lakeMaxWidth	Function to find line representing maximum lake Width
 - lakeMeanDepth	Function to return lake Mean Depth
 - lakeMeanWidth	Function to return lake Mean Width
 - lakemorpho	Lake Morphometry in R
 - lakeMorphoClass	Function to create a lakeMorpho class - this is input to all other methods
 - lakeShorelineDevelopment	Function to calculate shoreline development
 - lakeShorelineLength	Function to calculate shoreline length
 - lakeSurfaceArea	Return lake surface area
 - lakeSurroundTopo	Calculate surrounding topography for lake
 - lakeVolume	Caluclates Lake Volume in R
 - plot.lakeMorpho	Default plotting of a lakeMorpho object

- Included Data
 - exampleElev  Elevation Data for 'lakemorpho' examples
 - exampleLake	Lake Data for 'lakemorpho' examples

#Software Availability

The `lakemorpho` package is currently available directly from the Comprehensive R Archive Network (CRAN) and may simply be installed and loaded in R via:

```{r, eval=FALSE}
install.packages('lakemorpho')
library('lakemorpho')
```

To access the help pages (including a version of this manuscript) use `r help(packages='lakemorpho')`.  

There are tentative plans to continue developing new functions for `lakemorpho` and these new features will be available first through the development version on GitHub at [http://github.com/usepa/lakemorpho](http://github.com/USEPA/lakemorpho).  To install and load the development version requires use of the `devtools` package.  This may be done with:

```{r, eval=FALSE}
install.packages('devtools')
library('devtools')
install_github('USEPA/lakemorpho')
library(lakemorpho)
```


#References